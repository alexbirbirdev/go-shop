<script>
import { mapGetters } from 'vuex'
import axios from 'axios'
export default {
  name: 'VHeader',

  components: {},

  props: {},

  data() {
    return {
      favCount: 0,
      isFavLoading: true,
      isCartLoading: true,
    }
  },

  computed: {
    
    ...mapGetters('favorites', {
      favoritesCount: 'count'
    }),
    
    ...mapGetters('cart', {
      cartCount: 'count'
    }),
  },

  methods: {
    // ...mapMutations('favorites', ['SET_COUNT']),
    // setFavCount() {
    //   this.SET_COUNT(state.count, favCount)
    // },

    async getFavCount() {
      if (!localStorage.getItem("role")) return
      try {
        this.isFavLoading = true
        const response = await axios.get('http://localhost:8080/favorites/count', {
          headers: {
            Authorization: localStorage.getItem('token'),
          },
        })
        // this.favCount = response.data.count
        this.$store.commit('favorites/SET_COUNT', response.data.count)
        // localStorage.setItem('favCount', this.favCount)
      } catch (error) {
        console.log(error)
      } finally {
        this.isFavLoading = false
      }
    },
    async getCartCount() {
      if (!localStorage.getItem("role")) return
      try {
        this.isCartLoading = true
        const response = await axios.get('http://localhost:8080/cart/count', {
          headers: {
            Authorization: localStorage.getItem('token'),
          },
        })
        // this.favCount = response.data.count
        this.$store.commit('cart/SET_COUNT', response.data.count)
        // localStorage.setItem('favCount', this.favCount)
      } catch (error) {
        console.log(error)
      } finally {
        this.isCartLoading = false
      }
    },
  },

  watch: {},

  created() {
    this.getFavCount()
    this.getCartCount()
  },
  mounted() {},
  updated() {},
  beforeUnmount() {},
  unmounted() {},
}
</script>

<template>
  <header class="bg-white shadow-sm py-4 fixed top-0 left-0 w-full z-20 flex justify-center">
    <div class="container flex justify-between items-center">
      <router-link to="/"><h1 class="text-xl font-bold">GO Shop</h1></router-link>
      <nav class="flex items-center gap-3">
        <router-link
          class="duration-200 hover:text-blue-500 cursor-pointer"
          :active-class="'text-blue-600 hover:text-blue-600 !cursor-default'"
          to="/catalog/"
          >Каталог</router-link
        >

        <router-link
          class="duration-200 hover:bg-sky-100 cursor-pointer p-1 rounded-lg bg-neutral-200 relative"
          :active-class="'bg-sky-100 !cursor-default'"
          to="/favorite/"
        >
          <svg class="w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12.4891 5.92615C14.6343 3.73233 18.1651 3.73227 20.3103 5.92615C22.3882 8.05145 22.3881 11.4473 20.3103 13.5726L13.2107 20.8334C12.5877 21.4705 11.5878 21.5102 10.9178 20.9525L10.7889 20.8334L3.68925 13.5726C1.61143 11.4473 1.61136 8.05148 3.68925 5.92615C5.83453 3.73233 9.3653 3.73227 11.5105 5.92615L11.9998 6.42615L12.4891 5.92615ZM19.2381 6.97498C17.6812 5.38286 15.1192 5.38292 13.5623 6.97498L12.5359 8.02381C12.3949 8.16803 12.2015 8.24937 11.9998 8.24939C11.798 8.24939 11.6048 8.16806 11.4637 8.02381L10.4373 6.97498C8.88045 5.38286 6.3184 5.38292 4.76152 6.97498C3.25388 8.51732 3.25394 10.9814 4.76152 12.5238L11.8611 19.7845L11.8914 19.8099C11.9674 19.8613 12.0718 19.8528 12.1385 19.7845L19.2381 12.5238C20.7456 10.9814 20.7457 8.51728 19.2381 6.97498Z"
              fill="black"
            />
          </svg>
          <div
            v-if="!isFavLoading && favoritesCount != 0"
            class="absolute -top-2 -right-2 py-0.5 px-2 text-xs bg-sky-200 shadow-xl rounded-md"
          >
            {{ favoritesCount }}
          </div>
        </router-link>
        <router-link
          class="duration-200 hover:bg-sky-100 cursor-pointer p-1 rounded-lg bg-neutral-200 relative"
          :active-class="'bg-sky-100 !cursor-default'"
          to="/cart/"
        >
          <svg class="w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M11.9997 2.25C13.5581 2.25 14.7935 2.24897 15.7741 2.36621C16.7732 2.48568 17.5981 2.73662 18.2995 3.30176L18.4753 3.4502C18.5322 3.5008 18.5878 3.55314 18.6423 3.60645L18.8698 3.84961C19.3707 4.43653 19.6614 5.1486 19.8678 6.00488C20.0992 6.96492 20.2428 8.19175 20.4255 9.73926L20.6891 11.9746C20.9325 14.0363 21.1258 15.6609 21.0983 16.9355C21.0721 18.1507 20.8454 19.162 20.1872 19.9922L20.0495 20.1553C19.2852 21.0151 18.2591 21.3954 16.9753 21.5752C15.7126 21.752 14.0759 21.75 11.9997 21.75C9.92346 21.75 8.28677 21.752 7.0241 21.5752C5.82074 21.4067 4.84355 21.0621 4.09636 20.3115L3.94988 20.1553C3.18563 19.2954 2.92905 18.2316 2.90105 16.9355C2.87353 15.6609 3.06684 14.0363 3.31023 11.9746L3.5739 9.73926L3.70574 8.6377C3.83403 7.59492 3.95799 6.72485 4.13152 6.00488C4.36733 5.02658 4.71352 4.23672 5.35711 3.60645L5.5241 3.4502C5.5813 3.39934 5.64027 3.3498 5.69988 3.30176C6.40121 2.73659 7.22619 2.4857 8.22527 2.36621C9.20588 2.24896 10.4413 2.25 11.9997 2.25ZM11.9997 3.75C10.4044 3.75 9.27396 3.75132 8.40301 3.85547C7.55093 3.95741 7.03765 4.14947 6.64031 4.46973C6.59971 4.50247 6.56014 4.53665 6.52117 4.57129L6.40594 4.67773C6.04137 5.03483 5.79064 5.52211 5.58953 6.35645C5.43542 6.9959 5.32209 7.7869 5.19597 8.81055L5.06316 9.91504L4.79949 12.1504C4.55082 14.2567 4.37534 15.7582 4.40008 16.9033C4.42435 18.027 4.64201 18.6765 5.07097 19.1592L5.2409 19.3311C5.66207 19.7124 6.25811 19.9534 7.23211 20.0898C8.36647 20.2487 9.87857 20.25 11.9997 20.25C14.1208 20.25 15.6329 20.2487 16.7673 20.0898C17.8801 19.934 18.4994 19.6416 18.9284 19.1592L19.0798 18.9697C19.409 18.5067 19.5781 17.8866 19.5993 16.9033C19.624 15.7582 19.4485 14.2568 19.1999 12.1504L18.9362 9.91504C18.7492 8.33106 18.6153 7.20911 18.4098 6.35645C18.2338 5.6262 18.0194 5.16218 17.7243 4.81836L17.5934 4.67773C17.5561 4.64122 17.5172 4.60595 17.4782 4.57129L17.3591 4.46973C16.9617 4.1495 16.4485 3.95739 15.5964 3.85547C14.7254 3.75134 13.5949 3.75 11.9997 3.75ZM14.9997 6.25C15.4139 6.25 15.7497 6.58579 15.7497 7V9C15.7497 11.0711 14.0708 12.75 11.9997 12.75C9.92874 12.7499 8.24969 11.071 8.24969 9V7C8.24969 6.58588 8.5856 6.25015 8.99969 6.25C9.4139 6.25 9.74969 6.58579 9.74969 7V9C9.74969 10.2425 10.7572 11.2499 11.9997 11.25C13.2423 11.25 14.2497 10.2426 14.2497 9V7C14.2497 6.58588 14.5856 6.25015 14.9997 6.25Z"
              fill="black"
            />
          </svg>
          <div
            v-if="!isCartLoading && cartCount != 0"
            class="absolute -top-2 -right-2 py-0.5 px-2 text-xs bg-sky-200 shadow-xl rounded-md"
          >
            {{ cartCount }}
          </div>
        </router-link>
        <router-link
          class="duration-200 hover:bg-sky-100 cursor-pointer p-1 rounded-lg bg-neutral-200"
          :active-class="'bg-sky-100 !cursor-default'"
          to="/orders/"
        >
          <svg class="w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12 1.53809C12.3981 1.53809 12.7521 1.64289 13.1094 1.79883C13.452 1.94837 13.8443 2.16696 14.3066 2.42383L19.3066 5.20117C19.7953 5.47263 20.21 5.7025 20.5332 5.92676C20.8701 6.16056 21.1578 6.42136 21.3701 6.78223L21.4443 6.91797C21.6041 7.23758 21.6762 7.57177 21.7119 7.92871C21.751 8.32009 21.75 8.79459 21.75 9.35352V14.6465C21.75 15.2054 21.751 15.6799 21.7119 16.0713C21.6762 16.4282 21.6041 16.7624 21.4443 17.082L21.3701 17.2178C21.1578 17.5787 20.8701 17.8394 20.5332 18.0732C20.21 18.2975 19.7953 18.5274 19.3066 18.7988L14.3066 21.5762C13.8443 21.833 13.452 22.0516 13.1094 22.2012C12.7521 22.3571 12.3982 22.4619 12 22.4619C11.6019 22.4619 11.2479 22.3571 10.8906 22.2012C10.548 22.0516 10.1557 21.833 9.69336 21.5762L4.69336 18.7988C4.20472 18.5274 3.78996 18.2975 3.4668 18.0732C3.17201 17.8687 2.91477 17.6435 2.71289 17.3486L2.62989 17.2178C2.41765 16.857 2.32888 16.4792 2.28809 16.0713C2.249 15.6799 2.25 15.2054 2.25 14.6465V9.35352C2.25 8.79459 2.24898 8.32009 2.28809 7.92871C2.32889 7.52085 2.41762 7.14297 2.62989 6.78223L2.71289 6.65137C2.91478 6.35649 3.17201 6.13134 3.4668 5.92676C3.78997 5.7025 4.20473 5.47263 4.69336 5.20117L9.69336 2.42383L10.3369 2.07031C10.5354 1.9649 10.7194 1.87355 10.8906 1.79883C11.2479 1.64289 11.6019 1.53809 12 1.53809ZM3.75782 8.48438C3.75089 8.71761 3.75 8.99899 3.75 9.35352V14.6465C3.75 15.235 3.75132 15.6221 3.78125 15.9219C3.80953 16.2047 3.85902 16.3485 3.92285 16.457L3.97949 16.54C4.04595 16.6252 4.1471 16.7192 4.32227 16.8408C4.56976 17.0126 4.90744 17.2015 5.42188 17.4873L10.4219 20.2656C10.7699 20.459 11.0329 20.6039 11.25 20.7129V12.4512L3.75782 8.48438ZM12.75 12.4512V20.7129C12.9671 20.6039 13.2301 20.459 13.5781 20.2656L18.5781 17.4873C19.0926 17.2015 19.4302 17.0126 19.6777 16.8408C19.9114 16.6786 20.0133 16.5656 20.0772 16.457L20.1221 16.3672C20.1643 16.2677 20.1975 16.1339 20.2188 15.9219C20.2487 15.6221 20.25 15.235 20.25 14.6465V9.35352C20.25 8.99897 20.2481 8.71762 20.2412 8.48438L12.75 12.4512ZM8.96387 9.54297L12 11.1504L19.6152 7.11914C19.3738 6.95818 19.0513 6.77555 18.5781 6.5127L16.499 5.35742L8.96387 9.54297ZM12 3.03809C11.8799 3.03809 11.7372 3.06506 11.4902 3.17285C11.3595 3.22992 11.2144 3.30329 11.041 3.39551L10.4219 3.73438L5.42188 6.5127C4.9483 6.77579 4.62532 6.95807 4.38379 7.11914L7.38281 8.70605L14.9561 4.5L13.5781 3.73438C13.0913 3.46391 12.7714 3.28703 12.5098 3.17285C12.2628 3.06507 12.1201 3.03809 12 3.03809Z"
              fill="black"
            />
          </svg>
        </router-link>
        <router-link
          class="duration-200 hover:bg-sky-100 cursor-pointer p-1 rounded-lg bg-neutral-200"
          :active-class="'bg-sky-100 !cursor-default'"
          to="/profile/"
        >
          <svg class="w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M15.2441 14.2559C17.754 14.3829 19.75 16.4585 19.75 19C19.75 20.5188 18.5188 21.75 17 21.75H7C5.48122 21.75 4.25 20.5188 4.25 19C4.25 16.3766 6.37665 14.25 9 14.25H15L15.2441 14.2559ZM9 15.75C7.20507 15.75 5.75 17.2051 5.75 19C5.75 19.6904 6.30964 20.25 7 20.25H17C17.6904 20.25 18.25 19.6904 18.25 19C18.25 17.2611 16.8843 15.8408 15.167 15.7539L15 15.75H9ZM12 2.25C14.6234 2.25 16.75 4.37665 16.75 7C16.75 9.62335 14.6234 11.75 12 11.75C9.37665 11.75 7.25 9.62335 7.25 7C7.25 4.37665 9.37665 2.25 12 2.25ZM12 3.75C10.2051 3.75 8.75 5.20507 8.75 7C8.75 8.79493 10.2051 10.25 12 10.25C13.7949 10.25 15.25 8.79493 15.25 7C15.25 5.20507 13.7949 3.75 12 3.75Z"
              fill="black"
            />
          </svg>
        </router-link>
      </nav>
    </div>
  </header>
</template>

<style scoped></style>
